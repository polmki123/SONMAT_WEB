<div id="page-start"></div>

<section class="main-container">

    <div class="container">
        <div class="row">

            <!-- main start -->
            <!-- ================ -->
                <div class="main col-12">
                    <!-- page-title start -->
                    <!-- ================ -->

                    <br/>
                    <br/>
                    <form class="form-group">
                        <div class="row">

                            <div class="col-lg-12">
                                <input type="email" class="form-control" name="inputEmail" placeholder="이메일을 입력하세요">
                            </div>
                        </div>
                        <br/>
                        <br/>
                        <div class="row">
                            <div class="col-lg-12">
                                <input class="form-control" type="text" name="inputTitle" placeholder="제목을 입력하세요">
                            </div>
                        </div>
                        <div class="separator"></div>

                        <div id="summernote" name="inputContents"></div>
                        <div class="separator"></div>
                        <div class="text-right">
                            <button type="button" class="btn btn-success" id="upload_btn"><i class="fa fa-save"></i>저장</button>
                        </div>
                    </form>
                </div>


            <!-- main end -->

        </div>
    </div>
</section>

<script type="text/javascript">

    // 사용 가능한 Dynamic 폰트 리스트
    var font_list = <%- JSON.stringify(font_list) %>;

    // 에디터에 등록할 대표 폰트 리스트
    var editor_font_list = <%- JSON.stringify(editor_font_list) %>;

    var t = <%- JSON.stringify(result) %>;
    console.log("result ", t);


    console.log("font list : ", font_list);
    console.log("editor font list : ", editor_font_list);

    // 모튼 font를 font-face에 등록
    font_list.forEach(function(dynamic_font) {

        dynamic_font.font_files.forEach(function(font_file) {

            var font_face = new FontFace(font_file.font_name, 'url(/../' + font_file.file_path + ')');

            // 폰트 load
            font_face.load().then(function(loaded_face) {
                // load 된 폰트 추가
                document.fonts.add(loaded_face);
            }).catch(function(error) { });
        });
    });

    var editor = $('#summernote').summernote({
        placeholder: '당신의 손글씨가 담긴 편지로 마음을 전해보세요',
        tabsize: 2,
        height: 400,
        fontNames: editor_font_list,
        fontNamesIgnoreCheck: editor_font_list,
        //toolbar : false
    });


    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }



    function getRandomFont() {
        var randomFontIndex = getRandomInt(0 , font_names.length);
        return font_names[randomFontIndex];
    }

    // summernote.change font
    editor.on('summernote.keyup', function(we, contents, $editable) {
        var randomFont = getRandomFont();
        console.log(randomFont);
        editor.summernote('fontName' , randomFont);

    });

        // 업로드 버튼 - click event
    $(document).on('click', '#upload_btn', function() {

        var formData = {}
        formData.email = $("input[name=inputEmail]").val()
        formData.title = $("input[name=inputTitle]").val()
        formData.contents = $("div#summernote").summernote('code');

        var MESSAGE_POST_UPLOAD_URL = '/api/message';

        function fn_success(sonmat_req_id) {
            window.location.href = "/message/to/" + sonmat_req_id;
        }

        AjaxUtils.postResult(MESSAGE_POST_UPLOAD_URL, formData, fn_success);

    });

    $(document).on('focusout', 'input[name=inputEmail]', function() {

        var formData = {}
        formData.email = $("input[name=inputEmail]").val()
        var CHECK_EMAIL_URL = '/api/message/check_email';

        function fn_success(user) {
            if (user.name == null){
                // user = {}
                $("input[name=inputEmail]").attr('class', 'form-control is-invalid');
            }else{
                // user = { id, name, .... }
                $("input[name=inputEmail]").attr('class', 'form-control is-valid');
            }
        }
        AjaxUtils.postResult(CHECK_EMAIL_URL, formData, fn_success);

    });

</script>